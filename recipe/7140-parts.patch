From ef8df4bf539d9383b56ae415c0605a01c6ac0437 Mon Sep 17 00:00:00 2001
From: "Murillo Rojas, Luis" <luis.murillo.rojas@intel.com>
Date: Fri, 17 Jan 2025 15:17:06 -0600
Subject: [PATCH 01/18] Solve PyTorch Ops compilation error in Windows

---
 cpp/open3d/ml/impl/continuous_conv/ContinuousConv.h         | 6 ++++--
 .../ml/impl/continuous_conv/ContinuousConvBackpropFilter.h  | 6 ++++--
 .../ml/impl/continuous_conv/ContinuousConvTranspose.h       | 6 ++++--
 .../continuous_conv/ContinuousConvTransposeBackpropFilter.h | 6 ++++--
 4 files changed, 16 insertions(+), 8 deletions(-)

diff --git a/cpp/open3d/utility/Download.cpp b/cpp/open3d/utility/Download.cpp
index 6f3443cc9..15b954413 100644
--- a/cpp/open3d/utility/Download.cpp
+++ b/cpp/open3d/utility/Download.cpp
@@ -14,7 +14,7 @@
 #include <openssl/md5.h>
 
 // https://stackoverflow.com/a/41873190/1255535
-#ifdef WINDOWS
+#ifdef _WIN32
 #pragma comment(lib, "wldap32.lib")
 #pragma comment(lib, "crypt32.lib")
 #pragma comment(lib, "Ws2_32.lib")
diff --git a/cpp/open3d/utility/FileSystem.cpp b/cpp/open3d/utility/FileSystem.cpp
index 604507edc..59b3c4506 100644
--- a/cpp/open3d/utility/FileSystem.cpp
+++ b/cpp/open3d/utility/FileSystem.cpp
@@ -13,7 +13,7 @@
 #include <cstdio>
 #include <cstdlib>
 #include <sstream>
-#ifdef WIN32
+#ifdef _WIN32
 #include <direct.h>
 #include <dirent/dirent.h>
 #include <io.h>
@@ -28,7 +28,7 @@
 #include <unistd.h>
 #endif
 
-#ifdef WIN32
+#ifdef _WIN32
 #define _SILENCE_EXPERIMENTAL_FILESYSTEM_DEPRECATION_WARNING
 #endif
 #ifdef __APPLE__
@@ -55,7 +55,7 @@ static std::string GetEnvVar(const std::string &env_var) {
 
 std::string GetHomeDirectory() {
     std::string home_dir = "";
-#ifdef WINDOWS
+#ifdef _WIN32
     // %USERPROFILE%
     // %HOMEDRIVE%
     // %HOMEPATH%
@@ -235,7 +235,7 @@ bool DirectoryIsEmpty(const std::string &directory) {
 }
 
 bool MakeDirectory(const std::string &directory) {
-#ifdef WINDOWS
+#ifdef _WIN32
     return (_mkdir(directory.c_str()) == 0);
 #else
     return (mkdir(directory.c_str(), S_IRWXU) == 0);
@@ -395,7 +395,7 @@ std::string GetIOErrorString(const int errnoVal) {
         // Error below could be EWOULDBLOCK on Linux
         case EAGAIN:
             return "Resource unavailable, try again";
-#if !defined(WIN32)
+#if !defined(_WIN32)
         case EDQUOT:
             return "Over quota";
 #endif
diff --git a/cpp/open3d/visualization/rendering/filament/FilamentCamera.cpp b/cpp/open3d/visualization/rendering/filament/FilamentCamera.cpp
index 553bfe918..e7a1580c4 100644
--- a/cpp/open3d/visualization/rendering/filament/FilamentCamera.cpp
+++ b/cpp/open3d/visualization/rendering/filament/FilamentCamera.cpp
@@ -176,7 +176,7 @@ void FilamentCamera::SetProjection(const Eigen::Matrix3d& intrinsics,
     culling_proj[2][2] = (-far - near) / (far - near);
     culling_proj[3][2] = -2.0 * far * near / (far - near);
 
-#ifdef WIN32
+#ifdef _WIN32
     camera_->setCustomProjection(custom_proj, near, far);
 #else
     camera_->setCustomProjection(custom_proj, culling_proj, near, far);
diff --git a/cpp/open3d/visualization/visualizer/GuiVisualizer.cpp b/cpp/open3d/visualization/visualizer/GuiVisualizer.cpp
index 5f7584d7e..41cb1c226 100644
--- a/cpp/open3d/visualization/visualizer/GuiVisualizer.cpp
+++ b/cpp/open3d/visualization/visualizer/GuiVisualizer.cpp
@@ -799,7 +799,7 @@ void GuiVisualizer::Init() {
         file_menu->AddItem("Open...", FILE_OPEN, gui::KEY_O);
         file_menu->AddItem("Export Current Image...", FILE_EXPORT_RGB);
         file_menu->AddSeparator();
-#if defined(WIN32)
+#if defined(_WIN32)
         file_menu->AddItem("Exit", FILE_QUIT);
 #elif !defined(__APPLE__)  // quit goes in app menu on macOS
         file_menu->AddItem("Quit", FILE_QUIT, gui::KEY_Q);
diff --git a/cpp/pybind/pybind_filesystem.h b/cpp/pybind/pybind_filesystem.h
index 3617d6cad..d0854598f 100644
--- a/cpp/pybind/pybind_filesystem.h
+++ b/cpp/pybind/pybind_filesystem.h
@@ -21,7 +21,7 @@
 
 #include <string>
 
-#ifdef WIN32
+#ifdef _WIN32
 #define _SILENCE_EXPERIMENTAL_FILESYSTEM_DEPRECATION_WARNING
 #endif
 #ifdef __APPLE__
